- comment: C4 Container Diagram
  begin: ^\s*(C4Container|C4Context|C4Component|C4Dynamic|C4Deployment)
  beginCaptures:
    '1':
      name: keyword.control.mermaid
  patterns:
    - match: \%%.*
      name: comment
    - comment: title
      match: !regex |-
        ^\s*(title)\s+
        (\s*["\(\)$&%\^/#.,?!;:*+=<>\'\\\-\w\s]*)
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: string
    - comment: Person with parameters
      match: !regex |-
        ^\s*(Person|Person_Ext)\b
        (\()?
        (\w+)
        (\))?
        (,\s*)
        ("(?:[^"\\]|\\.)*")
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.parenthesis.close.mermaid
    - comment: Person without parameters
      match: !regex |-
        ^\s*(Person|Person_Ext)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: System with parameters
      match: !regex |-
        ^\s*(System|System_Ext|SystemDb|SystemDb_Ext|SystemQueue|SystemQueue_Ext)\b
        (\()?
        (\w+)
        (\))?
        (,\s*)
        ("(?:[^"\\]|\\.)*")
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.parenthesis.close.mermaid
    - comment: System without parameters
      match: !regex |-
        ^\s*(System|System_Ext|SystemDb|SystemDb_Ext|SystemQueue|SystemQueue_Ext)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: Container
      match: !regex |-
        ^\s*(Container|Container_Ext|ContainerDb|ContainerDb_Ext|ContainerQueue|ContainerQueue_Ext)\b
        (\()?
        (\w+)?
        (\))?
        (,\s*)
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.separator.comma.mermaid
        '10':
          name: string.quoted.double.mermaid
        '11':
          name: punctuation.parenthesis.close.mermaid
    - comment: Container without parameters
      match: !regex |-
        ^\s*(Container|Container_Ext|ContainerDb|ContainerDb_Ext|ContainerQueue|ContainerQueue_Ext)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: Rel with parameters
      match: !regex |-
        ^\s*(Rel|BiRel|Rel_U|Rel_D|Rel_L|Rel_R|Rel_Up|Rel_Down|Rel_Left|Rel_Right)\b
        (\()?\s*(\w+)?\s*(\))?
        (,\s*)
        (\w+)
        (,\s*)
        ("(?:[^"\\]|\\.)*")
        (,\s*)
        ("(?:[^"\\]|\\.)*")
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.section.group.begin.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.section.group.end.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: variable
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.separator.comma.mermaid
        '10':
          name: string.quoted.double.mermaid
        '11':
          name: punctuation.section.group.end.mermaid
    - comment: Rel without parameters
      match: !regex |-
        ^\s*(Rel|BiRel|Rel_U|Rel_D|Rel_L|Rel_R|Rel_Up|Rel_Down|Rel_Left|Rel_Right)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: Boundary with parameters
      match: !regex |-
        ^\s*(Boundary|Enterprise_Boundary|System_Boundary|Container_Boundary)\b
        (\()?\s*(\w+)?\s*(\))?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.separator.comma.mermaid
        '10':
          name: string.quoted.double.mermaid
        '11':
          name: punctuation.parenthesis.close.mermaid
    - comment: Boundary without parameters
      match: !regex |-
        ^\s*(Boundary|Enterprise_Boundary|System_Boundary|Container_Boundary)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: LAYOUT keywords
      match: !regex |-
        ^\s*(LAYOUT_TOP_DOWN|LAYOUT_LEFT_RIGHT|LAYOUT_LANDSCAPE|LAYOUT_WITH_LEGEND|SHOW_LEGEND|HIDE_STEREOTYPE)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: UpdateElementStyle
      match: !regex |-
        ^\s*(UpdateElementStyle)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: UpdateRelStyle
      match: !regex |-
        ^\s*(UpdateRelStyle)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: AddElementTag
      match: !regex |-
        ^\s*(AddElementTag|AddRelTag|AddBoundaryTag|AddPersonTag|AddSystemTag|AddContainerTag)\b
      captures:
        '1':
          name: keyword.control.mermaid
    - comment: Component
      match: !regex |-
        ^\s*(Component|ComponentDb|ComponentQueue|Component_Ext|ComponentDb_Ext|ComponentQueue_Ext)\b
        (\()?
        (\w+)?
        (\))?
        (,\s*)
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.parenthesis.close.mermaid
    - comment: Component
      match: !regex |-
        ^\s*(Component|ComponentDb|ComponentQueue|Component_Ext|ComponentDb_Ext|ComponentQueue_Ext)\b
        (\()?
        (\w+)?
        (\))?
        (,\s*)
        ("(?:[^"\\]|\\.)*")?
        (,\s*)?
        ("(?:[^"\\]|\\.)*")?
        (\))?
      captures:
        '1':
          name: keyword.control.mermaid
        '2':
          name: punctuation.parenthesis.open.mermaid
        '3':
          name: variable
        '4':
          name: punctuation.parenthesis.close.mermaid
        '5':
          name: punctuation.separator.comma.mermaid
        '6':
          name: string.quoted.double.mermaid
        '7':
          name: punctuation.separator.comma.mermaid
        '8':
          name: string.quoted.double.mermaid
        '9':
          name: punctuation.parenthesis.close.mermaid
    - comment: Deployment Node
      match: !regex |-
        ^\s*(Deployment_Node|Node|Node_L|Node_R)\b
      captures:
        '1':
          name: keyword.control.mermaid
  end: (^|\G)(?=\s*[`:~]{3,}\s*$)
